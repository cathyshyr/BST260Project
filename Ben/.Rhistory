library(XML)
library(RCurl)
library(rlist)
library(Lahman)
library(tidyverse)
library(openxlsx)
df_bbref_batting <- read.xlsx("BBRef_Batting.xlsx", na.strings = c("--", ""))
setwd("~/Documents/GitHub/BST260Project")
setwd("~/Documents/GitHub/BST260Project/Ben")
df_bbref_batting <- read.xlsx("BBRef_Batting.xlsx", na.strings = c("--", ""))
df_bbref_batting <- df_bbref_batting %>%
mutate(Age = as.numeric(Age),
WAR = as.numeric(WAR),
oWAR = as.numeric(oWAR),
dWAR = as.numeric(dWAR),
Salary = as.numeric(gsub('\\$|,', '', Salary))) %>%
select(Team, Year, WAR)
df_bbref_pitching <- read.xlsx("BBRef_Pitching.xlsx", na.strings = c("--", ""))
df_bbref_pitching <- df_bbref_pitching %>%
mutate(Age = as.numeric(Age),
WAR = as.numeric(WAR),
Salary = as.numeric(gsub('\\$|,', '', Salary))) %>%
select(Team, Year, WAR)
bbref <- rbind(df_bbref_batting, df_bbref_pitching)
bbref_WAR <- bbref %>%
group_by(Team, Year) %>%
summarize(WAR = sum(WAR, na.rm = TRUE)) %>%
rename(franchID = Team, yearID = Year)
merged_bbref <- Teams %>%
mutate(franchID = as.character(franchID)) %>%
select(franchID, yearID, W) %>%
left_join(bbref_WAR) %>%
mutate(source = "Baseball Reference")
?spread
names(merged_bbref)
merged_bbref_wide <- merged_bbref %>%
spread(franchID, WAR)
merged_bbref_wide
View(merged_bbref_wide)
require(tidyverse)
ny_airquality <- read_csv("https://raw.githubusercontent.com/datasciencelabs/data/master/ny_airquality.csv")
Q1 <- ny_airquality %>%
separate(Date, c("year", "month", "day"))
View(Q1)
Q1 %>%
group_month(month) %>%
summarize(avg_temp = mean(Temp))
Q1 %>%
group_by(month) %>%
summarize(avg_temp = mean(Temp))
## Q2
set.seed(1)
n <- 10^6
x <- 10^rnorm(n, 2, 0.5)
N <- 100
X <- sample(x, N)
M <- median(X)
m
M
?replicate
vals <- replicate(1000, FUN = {
X <- sample(x, N)
median(X)
})
vals <- replicate(1000, {
X <- sample(x, N)
median(X)
})
plot(vals)
hist(vals)
vals
vals <- replicate(10000, {
X <- sample(x, N)
median(X)
})
hist(vals)
mean(vals)
sd(vals)
## Q3
library(Lahman)
?Lahman
View(Batting)
View(Teams)
Teams %>%
filter(yearID == "1999") %>%
summarize(obs_cor = cor(HR, BB))
## Q4
url <- "https://raw.githubusercontent.com/datasciencelabs/data/master/midterm2-shoe-size.csv"
Q4 <- read_csv(url)
View(Q4)
Q4 %>%
summarize(obs_cor = cor(shoe_size, math_score))
Q4 %>%
group_by(grade) %>%
summarize(obs_cor = cor(shoe_size, math_score))
## Q6
m <- 100
n <- 10
set.seed(1)
x <- matrix(rnorm(n*m), m, n)
d <- dist(x[,3], x[,7])
d <- dist(x)
d
dist(rbind(x[, 3], x[, 7]))
4.151269^2
?dist
dist(rbind(x[, 3], x[, 7]), method = "euclidean")
euc.dist <- function(x1, x2) sqrt(sum((x1 - x2) ^ 2))
euc.dist(x[, 3], x[, 7])
## Q7
set.seed(1)
p <- 10
n <- 100
center1 <- 1:p
center2 <- 1 + p + rep(c(-0.1, 0.1), each = p/2)
X <- rbind(t(center1 + t(matrix(rnorm(n*p), n, p))), t(center2 + t(matrix(rnorm(n*p), n, p))))
y <- rep(c(0,1), each = n)
X
dim(X)
pca1 <- prcomp(X)
print(pca1)
plot(pca1, type = "l")
summary(pca1)
?knn
require(class)
?knn
?knn3
require(caret)
?knn.3
?knn
knn3
?knn3
?knn3
dim(y)
y <- rep(c(0,1), each = n)
length(y)
df <- as.data.frame(cbind(X, y))
View(df)
fit <- knn3(y ~ ., df, k=25)
url <- "https://raw.githubusercontent.com/datasciencelabs/data/master/midterm2-X.csv"
df2 <- read_csv(url)
View(df2)
pred <- predict(fit, newdata = df2, type="class")
pred
summary(fit)
## Q8
require(caret)
df <- as.data.frame(cbind(X, y))
fit <- knn3(y ~ ., df, k=25)
fit
pred <- predict(fit, newdata = df2, type="class")
pred
View(df2)
View(df)
pred <- predict(fit, newdata = df2)
pred
## Q8
require(caret)
df <- as.data.frame(cbind(X, y))
fit <- knn3(as.factor(y) ~ ., df, k=25)
url <- "https://raw.githubusercontent.com/datasciencelabs/data/master/midterm2-X.csv"
df2 <- read_csv(url)
pred <- predict(fit, newdata = df2)
pred <- predict(fit, newdata = df2, type = "class")
pred
fit
## Q9
url <- "https://raw.githubusercontent.com/datasciencelabs/data/master/midterm2-dat.csv"
Q9 <- read_csv(url)
View(Q9)
Q9 %>%
group_by(x) %>%
summarize(prob = mean(y == 1))
?logit
prob <- Q9 %>%
group_by(x) %>%
summarize(prob = mean(y == 1)) %>%
.$prob
logit(prob)
require(psych)
logit(prob)
prob
## Q10
Q10 <- Teams %>%
filter(year == "1961")
## Q10
Q10 <- Teams %>%
filter(yearID == "1961")
m1 <- lm(R ~ BB, data = Q10)
summary(m1)
confint(m1)
## Q11
master <- read_csv("https://raw.githubusercontent.com/datasciencelabs/data/master/Master.csv")
player_info <- master %>% select(playerID, nameFirst, nameLast, birthYear, height)
salaries <- read_csv("https://raw.githubusercontent.com/datasciencelabs/data/master/Salaries.csv")
View(salaries)
salaries_new <- salaries %>%
group_by(playerID) %>%
summarize(avg_salary = mean(salary))
View(salaries_new)
names(salaries_new)
merged_df <- player_info %>%
left_join(salaries_new, by = "playerID")
View(merged_df)
merged_df %>%
filter(birthYear == "1971") %>%
select(avg_salary) %>%
arrange(desc(avg_salary))
names(merged_df)
merged_df %>%
filter(birthYear == "1971") %>%
select(nameFirst, nameLast, avg_salary) %>%
arrange(desc(avg_salary))
View(Q10)
summary(m1)
-1.96*0.1952
## Q10
Q10 <- Teams %>%
mutate(yearID = as.numeric(yearID)) %>%
filter(yearID >= 1961)
View(Q10)
m1 <- lm(R ~ BB, data = Q10)
summary(m1)
confint(m1)
Q10 %>%
group_by(yearID) %>%
do(tidy(lm(R ~ BB, data = .), conf.int = TRUE)) %>%
filter(term == "BB") %>%
select(HR, estimate, conf.low, conf.high)
require(broom)
Q10 %>%
group_by(yearID) %>%
do(tidy(lm(R ~ BB, data = .), conf.int = TRUE)) %>%
filter(term == "BB") %>%
select(HR, estimate, conf.low, conf.high)
Q10 %>%
group_by(yearID) %>%
do(tidy(lm(R ~ BB, data = .), conf.int = TRUE)) %>%
filter(term == "BB")
test <- Teams %>%
mutate(yearID = as.numeric(yearID)) %>%
filter(yearID == 1961)
summary(lm(R ~ BB, data = test))
m1 <- lm(R ~ BB, data = test)
summary(m1)
?confint
confint(m1)
results <- Q10 %>%
group_by(yearID) %>%
do(tidy(lm(R ~ BB, data = .), conf.int = TRUE)) %>%
filter(term == "BB")
mean(results$conf.low)
mean(results$conf.high)
View(Q9)
prob <- Q9 %>%
group_by(x) %>%
summarize(prob = mean(y == 1)) %>%
.$prob
prob
?cdplot
cdplot(Q9$x, as.factor(Q9$y))
plot(Q9$x ~ Q9$y, type = 'l')
cdplot(Q9$x, as.factor(Q9$y))
install.packages("prob")
require(prob)
intersect(Q9$x, Q9$y)
table(Q9$x, Q9$y)
plot(x, y)
plot(Q9$x, Q9$y)
plot(Q9$x, Q9$y, type="l")
## Q10
Q10 <- Teams %>%
mutate(yearID = as.numeric(yearID)) %>%
filter(yearID >= 1961)
results <- Q10 %>%
group_by(yearID) %>%
do(tidy(lm(R ~ BB, data = .), conf.int = TRUE)) %>%
filter(term == "BB")
results
test <- Teams %>%
mutate(yearID = as.numeric(yearID)) %>%
filter(yearID == 1961)
m1 <- lm(R ~ BB, data = test)
summary(m1)
confint(m1)
summary(lm(R ~ BB, data = Q10))
m2 <- lm(R ~ BB, data = Q10)
summary(m2)
confint(m2)
mu_x <- mean(Q9$x)
mu_y <- mean(Q9$y)
mu_x
mu_y
s_x <- sd(Q9$x)
s_y <- sd(Q9$y)
s_y
s_x
r <- cor(Q9$x, Q9$y)
r
m_1 <-  r * s_y / s_x
m_1
b_1
b_1 <- mu_y - m_1*mu_x
b_1
prob <- Q9 %>%
group_by(round(x)) %>%
summarize(prob = mean(y == 1)) %>%
.$prob
prob
round(Q9$x)
?round
round(Q9$x, 1)
prob <- Q9 %>%
group_by(round(x, 1)) %>%
summarize(prob = mean(y == 1)) %>%
.$prob
prob
plot(prob)
plot(prob, type = "l")
logit(prob)
plot(logit(prob))
plot(logit(prob), type = "l")
## Q10
Q10 <- Teams %>%
mutate(yearID = as.numeric(yearID)) %>%
filter(yearID >= 1961)
View(Q10)
m2 <- lm(R ~ BB, data = Q10)
summary(m2)
0.02715*1.96
0.02715*-1.96
results
mean(results$conf.low)
mean(results$conf.high)
prob <- Q9 %>%
group_by(round(x, 2)) %>%
summarize(prob = mean(y == 1)) %>%
.$prob
prob
plot(prob, type = "l")
cdplot(Q9$x, as.factor(Q9$y))
Q9$y <- factor(Q9$y, levels = c(1, 0))
Q9$y
cdplot(Q9$x, Q9$y)
median(results$conf.low)
median(results$conf.high)
View(results)
length(results$conf.low > 0)
sd(vals)
help(Teams)
m1 <- lm(rpg ~ bbpg, data = test)
test <- Teams %>%
mutate(yearID = as.numeric(yearID)) %>%
filter(yearID == 1961) %>%
mutate(bbpg = BB/G, rpg = R/G)
m1 <- lm(rpg ~ bbpg, data = test)
summary(m1)
confint(m1)
cdplot(Q9$x, Q9$y)
?cdplot
mean(results$conf.low >= 0 & results$conf.low <= 0.9)
mean(results$conf.low >= 0.1 & results$conf.high <= 0.9)
results$conf.low >= 0.1 & results$conf.high <= 0.9
mean(results$conf.low >= 0.47 & results$conf.high <= 0.58)
mean(results$conf.low >= -.3 & results$conf.high <= 0.75)
mean(results$conf.low >= .3 & results$conf.high <= 0.75)
View(results)
Q9$x
merged_df %>%
filter(birthYear == "1971") %>%
select(nameFirst, nameLast, avg_salary) %>%
arrange(desc(avg_salary))
